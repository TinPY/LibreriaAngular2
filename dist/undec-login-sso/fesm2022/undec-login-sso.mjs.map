{"version":3,"file":"undec-login-sso.mjs","sources":["../../../projects/undec-login-sso/src/lib/undec-login-sso.service.ts","../../../projects/undec-login-sso/src/lib/undec-login-sso.component.ts","../../../projects/undec-login-sso/src/guard/token.guard.ts","../../../projects/undec-login-sso/src/interceptor/http-interceptor.interceptor.ts","../../../projects/undec-login-sso/src/pages/login/login.component.ts","../../../projects/undec-login-sso/src/pages/login/login.component.html","../../../projects/undec-login-sso/src/public-api.ts","../../../projects/undec-login-sso/src/undec-login-sso.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UndecLoginSsoService {\r\n\r\n  constructor() { }\r\n}\r\n","import { Component } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'lib-undec-login-sso',\r\n  standalone: true,\r\n  imports: [],\r\n  template: `\r\n    <p>\r\n      undec-login-sso works!\r\n    </p>\r\n  `,\r\n  styles: ``\r\n})\r\nexport class UndecLoginSsoComponent {\r\n\r\n}\r\n","import { CanActivateFn } from '@angular/router';\r\nimport * as jwt_decode from 'jwt-decode';\r\n\r\nlet redirectCount = 0;\r\n\r\nexport const tokenGuard: CanActivateFn = (route) => {\r\n  const localStorageToken = localStorage.getItem('undec-token');\r\n  if (localStorageToken) {\r\n    return true;\r\n  }\r\n\r\n  const tokenQueryParams = route.queryParamMap.get('idToken');\r\n  if (tokenQueryParams) {\r\n    const decodedToken: { [key: string]: string } = jwt_decode.jwtDecode(tokenQueryParams);\r\n    localStorage.setItem('user', decodedToken['email']);\r\n    localStorage.setItem('undec-token', tokenQueryParams);\r\n    return true;\r\n  }\r\n\r\n  if (redirectCount === 0) {\r\n    const locationBase64 = window.btoa(unescape(encodeURIComponent(window.location.origin + \"#/home\")))\r\n    const authUrl = \"http://localhost:8899/auth/login?state=\" + locationBase64\r\n    redirectCount = 1;\r\n    window.location.assign(authUrl);\r\n  }\r\n\r\n  return false;\r\n};\r\n","import { HttpInterceptorFn } from '@angular/common/http';\r\nimport {catchError} from 'rxjs';\r\n\r\nexport const authInterceptorFunctional: HttpInterceptorFn = (req, next) => {\r\n  const authToken = localStorage.getItem('undec-token');\r\n\r\n  if (!authToken) {\r\n    const locationBase64 = window.btoa(unescape(encodeURIComponent(window.location.href)))\r\n    const authUrl = \"http://localhost:8899/auth/login?state=\" + locationBase64\r\n    window.location.assign(authUrl);\r\n  }\r\n\r\n  // Clone the request and add the authorization header\r\n  const authReq = req.clone({\r\n    setHeaders: {\r\n      Authorization: `Bearer ${authToken}`\r\n    }\r\n  });\r\n\r\n  // Pass the cloned request with the updated header to the next handler\r\n  return next(authReq);\r\n};\r\n\r\nexport const responseInterceptorFunctional: HttpInterceptorFn = (req, next) => {\r\n  return next(req)\r\n      .pipe(\r\n          catchError(error => {\r\n            if (error.status === 403 || error.status === 401) {\r\n              localStorage.clear();\r\n              const authUrl = \"http://localhost:8899/auth/logout?logout_uri=\" + window.location.origin + \"/logout\"\r\n              window.location.assign(authUrl);\r\n            }\r\n            throw error;\r\n          })\r\n      )\r\n}\r\n","import {Component, OnInit} from '@angular/core';\r\nimport {Router} from '@angular/router';\r\nimport {ReactiveFormsModule} from '@angular/forms';\r\nimport {CommonModule} from '@angular/common';\r\n\r\n@Component({\r\n  selector: 'lib-login',\r\n  standalone: true,\r\n  imports: [CommonModule, ReactiveFormsModule],\r\n  templateUrl: './login.component.html',\r\n  styleUrl: './login.component.css'\r\n})\r\nexport class LoginComponent implements OnInit{\r\n  constructor(private router: Router) {\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (localStorage.getItem('undec-token')) {\r\n      this.router.navigate(['/home']);\r\n    }\r\n  }\r\n\r\n  login(): void {\r\n    const locationBase64 = window.btoa(unescape(encodeURIComponent(window.location.origin + \"#/home\")))\r\n    const authUrl = \"http://localhost:8899/auth/login?state=\" + locationBase64\r\n    window.location.assign(authUrl);\r\n  }\r\n}\r\n","<div class=\"container-fluid bg-dark h-100\">\r\n    <div class=\"row align-items-center h-100\">\r\n        <div class=\"col-md-3 col-lg-4\"></div>\r\n        <div class=\"col-12 col-md-6 col-lg-4\">\r\n            <div class=\"card mb-5\">\r\n                <div class=\"card-header text-light text-center h4\">\r\n                    <!--<img src=\"assets/img/undec.png\" alt=\"undec\">-->\r\n                    <h4 class=\"card-title text-primary\">Aplicacion UNdeC</h4>\r\n                </div>\r\n                <div class=\"card-body\">\r\n                    <div class=\"row pt-2\">\r\n                        <div class=\"col-12\">\r\n                            <button (click)=\"login()\" class=\"btn btn-primary w-100 mb-2\" type=\"submit\">\r\n                                <i class=\"fas fa-sign-in-alt\"></i> Ingresar\r\n                                <span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\" hidden=\"true\"></span>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"col-md-3 col-lg-4\"></div>\r\n    </div>\r\n</div>\r\n\r\n","/*\r\n * Public API Surface of undec-login-sso\r\n */\r\n\r\nexport * from './lib/undec-login-sso.service';\r\nexport * from './lib/undec-login-sso.component';\r\n\r\nexport * from './guard/token.guard';\r\nexport * from './interceptor/http-interceptor.interceptor';\r\n\r\nexport * from './pages/login/login.component';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}